<div class="checkout-page">
  <div class="container">
    <!-- Progress Steps -->
    <div class="checkout-progress">
      <div class="progress-step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-number">1</div>
        <span class="step-label">Contact</span>
      </div>
      <div class="progress-line" [class.completed]="currentStep > 1"></div>
      <div class="progress-step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-number">2</div>
        <span class="step-label">Shipping</span>
      </div>
      <div class="progress-line" [class.completed]="currentStep > 2"></div>
      <div class="progress-step" [class.active]="currentStep === 3">
        <div class="step-number">3</div>
        <span class="step-label">Payment</span>
      </div>
    </div>

    <div class="checkout-content">
      <!-- Main Checkout Form -->
      <div class="checkout-form">
        <form [formGroup]="checkoutForm">
          <!-- Step 1: Contact Information -->
          <div class="form-step" *ngIf="currentStep === 1">
            <h2>Contact Information</h2>
            
            <div class="form-group">
              <label for="email">Email Address</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                placeholder="Enter your email"
                class="form-input">
              <div class="error-message" *ngIf="checkoutForm.get('email')?.invalid && checkoutForm.get('email')?.touched">
                Please enter a valid email address
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" routerLink="/cart">Back to Cart</button>
              <button 
                type="button" 
                class="btn-primary" 
                [disabled]="!isStepValid(1)"
                (click)="nextStep()">
                Continue to Shipping
              </button>
            </div>
          </div>

          <!-- Step 2: Shipping Address -->
          <div class="form-step" *ngIf="currentStep === 2">
            <h2>Shipping Address</h2>
            
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name</label>
                <input 
                  type="text" 
                  id="firstName" 
                  formControlName="firstName" 
                  placeholder="First name"
                  class="form-input">
              </div>
              <div class="form-group">
                <label for="lastName">Last Name</label>
                <input 
                  type="text" 
                  id="lastName" 
                  formControlName="lastName" 
                  placeholder="Last name"
                  class="form-input">
              </div>
            </div>

            <div class="form-group">
              <label for="address">Address</label>
              <input 
                type="text" 
                id="address" 
                formControlName="address" 
                placeholder="Street address"
                class="form-input">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City</label>
                <input 
                  type="text" 
                  id="city" 
                  formControlName="city" 
                  placeholder="City"
                  class="form-input">
              </div>
              <div class="form-group">
                <label for="postalCode">Postal Code</label>
                <input 
                  type="text" 
                  id="postalCode" 
                  formControlName="postalCode" 
                  placeholder="Postal code"
                  class="form-input">
              </div>
            </div>

            <div class="form-group">
              <label for="country">Country</label>
              <select id="country" formControlName="country" class="form-select">
                <option value="">Select country</option>
                <option value="DK">Denmark</option>
                <option value="SE">Sweden</option>
                <option value="NO">Norway</option>
                <option value="DE">Germany</option>
                <option value="NL">Netherlands</option>
                <option value="UK">United Kingdom</option>
                <option value="US">United States</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="prevStep()">Back</button>
              <button 
                type="button" 
                class="btn-primary" 
                [disabled]="!isStepValid(2)"
                (click)="nextStep()">
                Continue to Payment
              </button>
            </div>
          </div>

          <!-- Step 3: Payment Information -->
          <div class="form-step" *ngIf="currentStep === 3">
            <h2>Payment Information</h2>
            
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <input 
                type="text" 
                id="cardNumber" 
                formControlName="cardNumber" 
                placeholder="1234 5678 9012 3456"
                class="form-input">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input 
                  type="text" 
                  id="expiryDate" 
                  formControlName="expiryDate" 
                  placeholder="MM/YY"
                  class="form-input">
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <input 
                  type="text" 
                  id="cvv" 
                  formControlName="cvv" 
                  placeholder="123"
                  class="form-input">
              </div>
            </div>

            <div class="form-group">
              <label for="cardName">Name on Card</label>
              <input 
                type="text" 
                id="cardName" 
                formControlName="cardName" 
                placeholder="Full name as on card"
                class="form-input">
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="prevStep()">Back</button>
              <button 
                type="button" 
                class="btn-primary" 
                [disabled]="!isStepValid(3) || isLoading"
                (click)="processPayment()">
                <span *ngIf="!isLoading">Complete Order</span>
                <span *ngIf="isLoading">Processing...</span>
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Order Summary -->
      <div class="order-summary">
        <h3>Order Summary</h3>
        
        <div class="summary-items">
          <div class="summary-item" *ngFor="let item of cartItems">
            <div class="item-image">
              <img [src]="getItemImage(item)" [alt]="item.product.name">
            </div>
            <div class="item-details">
              <h4>{{ item.product.name }}</h4>
              <div class="item-options">
                <span *ngIf="item.size">Size: {{ item.size }}</span>
                <span *ngIf="item.color">Color: {{ item.color }}</span>
              </div>
              <div class="item-quantity">Qty: {{ item.quantity }}</div>
            </div>
            <div class="item-price">
              {{ currencyService.getSymbol() }}{{ getItemTotal(item) }}
            </div>
          </div>
        </div>

        <div class="summary-totals">
          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ currencyService.getSymbol() }}{{ getSubtotal() }}</span>
          </div>
          <div class="summary-row">
            <span>Shipping</span>
            <span>Free</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span>{{ currencyService.getSymbol() }}{{ getSubtotal() }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
